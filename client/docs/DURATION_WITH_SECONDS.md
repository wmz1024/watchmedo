# 连续停留时间 - 精确到秒显示 ⏱️

## 更新说明

连续停留时间现在精确显示到秒，提供更准确的时间追踪。

## 显示格式

### 各种时长的显示示例

| 实际秒数 | 显示格式 |
|---------|---------|
| 5秒 | `5秒` |
| 30秒 | `30秒` |
| 65秒 | `1分钟 5秒` |
| 125秒 | `2分钟 5秒` |
| 3665秒 | `1小时 1分钟 5秒` |
| 7325秒 | `2小时 2分钟 5秒` |

### 规则说明

1. **始终显示秒数**：即使是完整的分钟或小时，也会显示"0秒"
2. **自动省略零值**：如果没有小时，不显示小时部分；如果没有分钟，不显示分钟部分
3. **秒数总是显示**：确保用户知道精确的时间

## 实际界面显示

### 场景1：刚开始聚焦
```
┌─────────────────────────────────────┐
│  🕐  连续停留: 15秒                  │
│      未切换其他应用的持续时间(精确到秒)│
└─────────────────────────────────────┘
```

### 场景2：聚焦1分钟多
```
┌─────────────────────────────────────┐
│  🕐  连续停留: 1分钟 23秒            │
│      未切换其他应用的持续时间(精确到秒)│
└─────────────────────────────────────┘
```

### 场景3：聚焦超过1小时
```
┌─────────────────────────────────────┐
│  🕐  连续停留: 1小时 15分钟 42秒     │
│      未切换其他应用的持续时间(精确到秒)│
└─────────────────────────────────────┘
```

### 场景4：仅几秒钟
```
┌─────────────────────────────────────┐
│  🕐  连续停留: 8秒                   │
│      未切换其他应用的持续时间(精确到秒)│
└─────────────────────────────────────┘
```

## 技术实现

### formatDuration 函数

```javascript
function formatDuration(seconds) {
    if (seconds < 0) seconds = 0;
    
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = Math.floor(seconds % 60);
    
    const parts = [];
    if (hours > 0) parts.push(`${hours}小时`);
    if (minutes > 0) parts.push(`${minutes}分钟`);
    parts.push(`${secs}秒`);  // 秒数总是显示
    
    return parts.join(' ');
}
```

### 使用方式

```javascript
// 在渲染聚焦应用时
${formatDuration(focusedApp.focused_duration || 0)}
```

## 优势

### 1. 精确追踪 🎯
- 精确到秒的时间显示
- 每10秒自动更新
- 实时反映停留时间变化

### 2. 清晰直观 👁️
- 一目了然的时间格式
- 自然的中文表达
- 符合用户阅读习惯

### 3. 专注监控 📊
- 适合短时间专注追踪（番茄工作法）
- 看到秒数变化更有紧迫感
- 帮助养成专注习惯

## 使用场景

### 场景1：番茄工作法（25分钟）
```
开始工作：
🕐 连续停留: 15秒

5分钟后：
🕐 连续停留: 5分钟 10秒

25分钟后：
🕐 连续停留: 25分钟 5秒 ✓ 完成一个番茄钟
```

### 场景2：快速任务追踪
```
查看文档：
🕐 连续停留: 2分钟 35秒

切换到编码：
🕐 连续停留: 8秒 (重新计时)

编码10分钟后：
🕐 连续停留: 10分钟 12秒
```

### 场景3：专注度监控
```
连续工作30分钟：
🕐 连续停留: 30分钟 45秒 ✓ 很好的专注

频繁切换：
🕐 连续停留: 1分钟 20秒 ⚠️ 注意力分散
```

## 实时更新机制

### 更新频率
- **API调用**：每10秒请求一次
- **数据刷新**：获取最新的聚焦状态和停留时间
- **界面更新**：实时显示新的时间

### 倒计时提示
```
┌─────────────────────────────────────┐
│ 🟢 正在使用的应用    10秒后刷新      │ ← 倒计时
├─────────────────────────────────────┤
│  🕐  连续停留: 5分钟 30秒            │ ← 精确到秒
└─────────────────────────────────────┘

9秒后：
┌─────────────────────────────────────┐
│ 🟢 正在使用的应用    9秒后刷新       │
├─────────────────────────────────────┤
│  🕐  连续停留: 5分钟 30秒            │ ← 还未更新
└─────────────────────────────────────┘

0秒后（刷新）：
┌─────────────────────────────────────┐
│ 🟢 正在使用的应用    10秒后刷新      │ ← 重置倒计时
├─────────────────────────────────────┤
│  🕐  连续停留: 5分钟 40秒            │ ← 更新了（+10秒）
└─────────────────────────────────────┘
```

## 测试方法

### 方法1：使用测试页面
```
访问: test_realtime.php
查看输出中的：
- 连续停留秒数: 325秒
- 格式化显示: 5分钟 25秒
```

### 方法2：浏览器控制台
```javascript
// 打开 device.php 页面
// 按 F12 → Console
// 输入：
formatDuration(125)
// 输出：2分钟 5秒

formatDuration(3665)
// 输出：1小时 1分钟 5秒

formatDuration(45)
// 输出：45秒
```

### 方法3：实际观察
```
1. 打开设备详情页面
2. 开始使用某个应用
3. 等待10秒，观察时间更新
4. 切换到其他应用
5. 再切回来，观察时间重置为几秒
```

## 性能影响

### API数据传输
```json
{
  "focused_duration": 325,  // 整数，秒数
  "focused_duration_formatted": "5分钟 25秒"  // 格式化字符串（可选）
}
```

- **数据大小**：非常小，只是一个整数
- **计算开销**：formatDuration 函数非常轻量
- **更新频率**：每10秒一次，不会造成性能问题

## 与其他时间显示的区别

| 位置 | 格式 | 是否显示秒 | 用途 |
|-----|------|-----------|-----|
| 连续停留时间 | `5分钟 30秒` | ✅ 是 | 当前聚焦应用的连续时长 |
| 应用使用时间 | `5小时 30分钟` | ❌ 否 | 一天内总使用时长 |
| 系统运行时间 | `2天 5小时` | ❌ 否 | 设备持续运行时长 |

## 用户反馈

### 优点
✅ 精确：能看到实时的秒数变化
✅ 直观：格式清晰易读
✅ 实用：适合短时间任务追踪

### 可能的改进
- [ ] 允许用户选择是否显示秒数
- [ ] 添加"已专注X分钟"的里程碑提示
- [ ] 显示历史最长连续停留记录

## 总结

通过精确到秒的显示，连续停留时间功能能够：

1. **准确追踪**：精确记录每一秒的专注时间
2. **实时反馈**：每10秒更新，看到时间增长
3. **专注提醒**：秒数的跳动提醒用户保持专注
4. **习惯培养**：帮助用户建立良好的工作习惯

这个功能特别适合：
- 使用番茄工作法的用户
- 需要追踪短时间任务的场景
- 想要提高工作专注度的用户
- 需要精确时间记录的场合

---

**更新日期**: 2024-01-XX
**版本**: v1.1
**相关文件**: 
- `client/public/assets/js/device.js`
- `client/api/stats.php`
- `client/public/test_realtime.php`

