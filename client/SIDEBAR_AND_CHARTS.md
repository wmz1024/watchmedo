# 侧边栏设备列表和折线图功能 📊

## 功能概述

在设备详情页面添加左侧边栏，实时显示其他设备状态，并将系统监控改为折线统计图。

## 新增功能

### 1. 左侧边栏 - 其他设备列表 📱

#### 特性
- ✅ 显示除当前设备外的所有设备
- ✅ 实时更新在线状态（每10秒）
- ✅ 显示设备名称和计算机名
- ✅ 显示在线/离线状态
- ✅ 显示最后上报时间
- ✅ 点击设备快速切换
- ✅ 当前设备高亮显示
- ✅ 固定定位（sticky）

#### 界面展示
```
┌──────────────────┐
│ 其他设备    3台   │
├──────────────────┤
│ ┌──────────────┐ │
│ │ 办公电脑  🟢  │ │
│ │ OFFICE-PC    │ │
│ │ 在线  2分钟前 │ │
│ └──────────────┘ │
│                  │
│ ┌──────────────┐ │
│ │ 家用笔记本 🟢 │ │
│ │ HOME-LAPTOP  │ │
│ │ 在线  5秒前   │ │
│ └──────────────┘ │
│                  │
│ ┌──────────────┐ │
│ │ 测试机器  ⚫  │ │
│ │ TEST-PC      │ │
│ │ 离线  2天前  │ │
│ └──────────────┘ │
└──────────────────┘
```

### 2. 折线统计图 📈

#### 特性
- ✅ 三条折线（CPU/内存/应用数）
- ✅ 双Y轴（左侧百分比，右侧应用数）
- ✅ 保留最近30个数据点（5分钟）
- ✅ 平滑曲线
- ✅ 渐变填充（CPU和内存）
- ✅ 交互提示
- ✅ 每10秒自动更新

#### 图表展示
```
┌─────────────────────────────────────────────┐
│ 实时系统监控          最近5分钟变化趋势      │
├─────────────────────────────────────────────┤
│ 图例: ━ CPU使用率  ━ 内存使用率  --- 活跃应用数 │
│                                             │
│ %│                                      个  │
│100│                                      30 │
│   │           ╱━━╲                         │
│ 80│      ━━╱      ━╲━━                  20 │
│   │    ╱              ╲                    │
│ 60│━━━                 ━━━━             10 │
│   │                                        │
│ 40│        ╱━╲                             │
│   │    ━━╱   ━╲━━                          │
│ 20│                                      0 │
│   └────────────────────────────────────    │
│   14:30    14:32    14:34    14:36         │
└─────────────────────────────────────────────┘
```

## 页面布局

### 整体布局
```
┌─────────────────────────────────────────────────┐
│              导航栏                              │
├──────────┬──────────────────────────────────────┤
│          │                                      │
│ 侧边栏   │        主内容区域                     │
│          │                                      │
│ [设备1]  │  [设备概览]                          │
│ [设备2]  │  [实时监控折线图]                     │
│ [设备3]  │  [聚焦应用] [网络流量]               │
│          │  [应用使用分布] [时间统计]            │
│          │  [应用详细列表]                       │
│          │                                      │
└──────────┴──────────────────────────────────────┘
```

### 响应式布局

**大屏幕 (≥1024px)**
```
侧边栏(256px) + 主内容(flex-1)
```

**中等屏幕 (768px-1024px)**
```
侧边栏(200px) + 主内容(flex-1)
```

**小屏幕 (<768px)**
```
侧边栏隐藏或折叠
主内容全宽
```

## 技术实现

### HTML结构 (device.php)

```html
<div class="flex max-w-7xl mx-auto">
    <!-- 左侧边栏 -->
    <aside class="w-64 mr-6 flex-shrink-0">
        <div class="sticky top-4">
            <h3>其他设备</h3>
            <div id="other-devices-list">
                <!-- 动态生成设备卡片 -->
            </div>
        </div>
    </aside>
    
    <!-- 主内容 -->
    <div class="flex-1">
        <!-- 设备详情内容 -->
    </div>
</div>
```

### JavaScript逻辑 (device.js)

#### 1. 加载其他设备
```javascript
async function loadOtherDevices() {
    const response = await fetch('../api/stats.php?action=overview');
    const devices = await response.json();
    renderOtherDevices(devices.data);
}
```

#### 2. 渲染设备列表
```javascript
function renderOtherDevices(devices) {
    // 过滤当前设备
    const otherDevices = devices.filter(d => d.id != deviceId);
    
    // 生成设备卡片
    otherDevices.map(device => {
        // 设备名称
        // 在线状态
        // 最后上报时间
    });
}
```

#### 3. 实时更新
```javascript
// 每10秒自动刷新
setInterval(() => {
    loadRealtimeData();
    loadOtherDevices(); // 同时刷新侧边栏
}, 10000);
```

### CSS样式

#### 侧边栏固定定位
```css
.sticky {
    position: sticky;
    top: 1rem;  /* 距离顶部16px */
}
```

#### 设备卡片悬停效果
```css
.hover:border-blue-300 {
    border-color: #93c5fd;
}

.hover:bg-blue-50 {
    background-color: #eff6ff;
}
```

## 数据流程

### 侧边栏更新流程
```
页面加载
    ↓
loadOtherDevices()
    ↓
API: /api/stats.php?action=overview
    ↓
返回所有设备列表
    ↓
过滤当前设备
    ↓
renderOtherDevices()
    ↓
显示在侧边栏
    ↓
每10秒自动刷新
```

### 设备卡片数据
```json
{
  "id": 2,
  "name": "办公电脑",
  "computer_name": "OFFICE-PC",
  "is_online": true,
  "last_seen_ago": "2分钟前"
}
```

## 删除的元素

### 1. 系统运行时间 ❌
```html
<!-- 已删除 -->
<div>
    <p>系统运行时间</p>
    <p id="uptime">5小时 30分钟</p>
</div>
```

### 2. 仪表盘图表 ❌
```javascript
// 已删除
let cpuGauge = null;
let memoryGauge = null;
let appsGauge = null;
function updateGauge() { ... }
```

改为单一的折线统计图。

## 用户体验

### 1. 快速切换设备 🔄
```
点击侧边栏中的设备 → 跳转到该设备详情页
当前设备高亮显示（蓝色背景）
```

### 2. 一览全局 👁️
```
不离开当前页面即可：
- 查看所有设备状态
- 知道哪些设备在线/离线
- 看到最后上报时间
```

### 3. 实时监控 ⚡
```
侧边栏每10秒更新：
- 在线状态变化（绿色脉冲）
- 最后上报时间更新
- 新设备自动出现
```

## 交互行为

### 悬停效果
```
鼠标移到设备卡片上：
- 边框变蓝色
- 背景变浅蓝色
- 鼠标变为手指
```

### 当前设备标识
```
当前正在查看的设备：
- 蓝色背景
- 蓝色边框
- 与其他设备区分
```

### 在线状态指示
```
在线设备:
- 🟢 绿色圆点
- 带脉冲动画
- "在线"文字

离线设备:
- ⚫ 灰色圆点
- 无动画
- "离线"文字
```

## 性能优化

### 1. Sticky定位
```css
position: sticky;
top: 1rem;
```
- 侧边栏跟随滚动
- 不需要JavaScript计算位置

### 2. 过滤逻辑
```javascript
// 只显示其他设备，不包括当前设备
const otherDevices = devices.filter(d => d.id != deviceId);
```

### 3. 复用API
```javascript
// 使用现有的overview API，无需额外接口
fetch('../api/stats.php?action=overview');
```

## 示例场景

### 场景1：监控多设备
```
用户有5台设备：
1. 办公电脑（当前查看） ← 主内容区
2. 家用笔记本 ← 侧边栏显示
3. 服务器 ← 侧边栏显示
4. 测试机 ← 侧边栏显示
5. 备用机 ← 侧边栏显示

快速切换：点击侧边栏的任意设备
```

### 场景2：发现离线设备
```
侧边栏显示：
- 办公电脑 🟢 在线
- 家用笔记本 🟢 在线
- 服务器 ⚫ 离线（2天前） ← 发现异常

点击服务器 → 查看详情 → 排查问题
```

### 场景3：实时监控
```
打开设备详情页：
- 主区域：当前设备的详细监控
- 侧边栏：其他设备的实时状态
- 折线图：系统资源变化趋势

全局掌握：所有设备一目了然
```

## 折线图详细配置

### 图表参数
```javascript
{
    smooth: true,           // 平滑曲线
    symbol: 'circle',       // 圆点标记
    symbolSize: 6,          // 点大小
    lineStyle: {
        width: 2            // 线宽
    },
    areaStyle: {
        // 渐变填充
        color: 'linear-gradient(...)'
    }
}
```

### 颜色方案
- **CPU**: #3b82f6 (蓝色)
- **内存**: #10b981 (绿色)
- **应用数**: #f59e0b (橙色，虚线)

### Y轴配置
```javascript
yAxis: [
    {
        name: '使用率(%)',
        min: 0,
        max: 100,          // 固定0-100%
        position: 'left'
    },
    {
        name: '应用数',
        min: 0,            // 动态最大值
        position: 'right'
    }
]
```

## 相关文件

### 修改的文件
1. `client/public/device.php` - 页面结构
   - 添加侧边栏容器
   - 删除运行时间
   - 删除仪表盘容器

2. `client/public/assets/js/device.js` - 逻辑
   - 添加 `loadOtherDevices()` 函数
   - 添加 `renderOtherDevices()` 函数
   - 优化折线图配置
   - 删除仪表盘相关代码

## 数据更新对比

### 侧边栏
| 更新内容 | 频率 | 来源 |
|---------|------|------|
| 设备列表 | 10秒 | overview API |
| 在线状态 | 10秒 | is_online字段 |
| 最后上报 | 10秒 | last_seen_ago |

### 折线图
| 指标 | 频率 | 来源 |
|-----|------|------|
| CPU | 10秒 | cpu_usage_avg |
| 内存 | 10秒 | memory_percent |
| 应用数 | 10秒 | processes计数 |

## 优势总结

### 空间利用 📐
- ✅ 侧边栏不占用主内容空间
- ✅ 折线图信息密度更高
- ✅ 整体布局更合理

### 信息丰富 📊
- ✅ 主区域：当前设备详细数据
- ✅ 侧边栏：其他设备概览
- ✅ 折线图：系统资源趋势

### 用户体验 ✨
- ✅ 快速切换设备
- ✅ 全局视野
- ✅ 实时更新
- ✅ 直观美观

## 测试方法

### 测试1：侧边栏显示
```
1. 确保有多台设备
2. 打开设备详情页
3. 查看左侧是否显示其他设备
4. 当前设备应该被过滤掉
```

### 测试2：实时更新
```
1. 观察侧边栏
2. 等待10秒
3. 查看最后上报时间是否更新
4. 查看在线状态是否正确
```

### 测试3：设备切换
```
1. 点击侧边栏的某个设备
2. 页面跳转到该设备详情
3. 侧边栏应该显示其他设备（不包括新选中的）
```

### 测试4：折线图更新
```
1. 观察折线图
2. 等待10秒
3. 查看是否添加新数据点
4. 等待5分钟，查看是否保持30个点
```

## 总结

现在设备详情页面拥有：

- ✅ **左侧边栏**: 其他设备实时状态，快速切换
- ✅ **折线统计图**: CPU/内存/应用数趋势展示
- ✅ **简洁布局**: 删除冗余信息（运行时间）
- ✅ **全局视野**: 一个页面掌握所有设备
- ✅ **实时更新**: 所有数据每10秒刷新

功能更强大，界面更美观，体验更流畅！🎉

