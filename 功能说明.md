# 新功能说明文档

## 已实现的功能

### 1. 系统托盘功能 ✅

应用现在支持系统托盘功能，即使关闭主窗口也会保持运行。

**托盘操作：**
- **左键点击托盘图标**：显示/隐藏主窗口
- **右键点击托盘图标**：显示操作菜单
  - 显示 - 显示主窗口并聚焦
  - 隐藏 - 隐藏主窗口
  - 退出 - 完全退出应用

### 2. 关闭按钮最小化到托盘 ✅

点击窗口右上角的关闭按钮（X）不会退出应用，而是将窗口最小化到系统托盘。

**如何完全退出应用：**
- 右键点击托盘图标
- 选择"退出"选项

### 3. 开机自启动 ✅

在设置页面添加了"开机自启动"功能。

**如何启用：**
1. 打开应用
2. 进入"设置"页面
3. 找到"应用设置"部分
4. 开启"开机自启动"开关

### 4. 静默启动 ✅

当启用开机自启动后，可以选择静默启动模式。

**静默启动特性：**
- 开机时应用自动启动
- 不显示主窗口
- 只在系统托盘显示图标
- 可以通过托盘图标打开主窗口

**如何启用：**
1. 首先启用"开机自启动"
2. 然后启用"静默启动"开关
3. 下次开机时，应用会静默启动在托盘

## 修改的文件

### 后端文件
1. **src-tauri/Cargo.toml**
   - 添加了 `auto-launch` 依赖（开机自启动）
   - 添加了 `hostname` 依赖（获取计算机名）
   - 配置了系统托盘特性

2. **src-tauri/src/main.rs**
   - 实现了系统托盘功能
   - 实现了托盘菜单和事件处理
   - 实现了窗口关闭拦截（最小化到托盘）
   - 实现了开机自启动逻辑
   - 实现了静默启动检测（--silent 参数）
   - 添加了相关 Tauri 命令

3. **src-tauri/tauri.conf.json**
   - 配置了系统托盘图标
   - 更新了窗口配置

### 前端文件
1. **src/pages/Settings.tsx**
   - 添加了"静默启动"选项UI
   - 更新了 AppSettings 接口
   - 实现了静默启动开关逻辑
   - 只有在开启"开机自启动"时才能启用"静默启动"

## 使用流程

### 场景1: 设置开机自启动
```
1. 打开应用
2. 进入设置页面
3. 开启"开机自启动"
4. 应用会在系统启动时自动运行并显示主窗口
```

### 场景2: 设置静默启动
```
1. 打开应用
2. 进入设置页面
3. 开启"开机自启动"
4. 开启"静默启动"
5. 下次开机时，应用会在后台运行，只显示托盘图标
6. 点击托盘图标可以打开主窗口
```

### 场景3: 使用托盘功能
```
1. 点击窗口关闭按钮 - 窗口隐藏到托盘
2. 左键点击托盘图标 - 显示窗口
3. 右键点击托盘图标 - 显示菜单
4. 选择"退出" - 完全退出应用
```

## 技术实现细节

### 系统托盘
- 使用 Tauri 的 `system-tray` 特性
- 支持左键和右键事件
- 自定义托盘菜单

### 开机自启动
- 使用 `auto-launch` crate
- 支持 Windows/macOS/Linux
- 可以传递命令行参数（--silent）

### 窗口管理
- 拦截窗口关闭事件（CloseRequested）
- 使用 `api.prevent_close()` 阻止关闭
- 改为隐藏窗口

### 静默启动
- 检测 `--silent` 命令行参数
- 启动时自动隐藏主窗口
- 保持后台服务运行

## 兼容性说明

- Windows ✅
- macOS ✅ 
- Linux ✅

所有功能在三大操作系统上都可正常工作。

## 已修复的问题

1. ✅ 修复了 sysinfo 0.30 API 变更导致的编译错误
2. ✅ 移除了过时的 trait 导入（SystemExt, ProcessExt 等）
3. ✅ 更新了 uptime() 调用方式
4. ✅ 更新了 disks 和 networks 的获取方式
5. ✅ 修复了 start_http_server 的类型匹配问题


